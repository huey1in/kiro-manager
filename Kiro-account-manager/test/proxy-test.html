<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API åä»£æœåŠ¡æµ‹è¯•</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #e0e0e0;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #f59e0b;
      font-size: 2rem;
    }
    .config-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .config-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    .config-item { display: flex; flex-direction: column; gap: 5px; }
    .config-item label { font-size: 12px; color: #888; }
    .config-item input {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 14px;
    }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }
    .test-card {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .test-card h3 {
      color: #f59e0b;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .test-card h3 .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 10px;
      background: rgba(245,158,11,0.2);
    }
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: #fff;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(245,158,11,0.3); }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.2); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .result-box {
      margin-top: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .result-box.success { border-left: 3px solid #22c55e; }
    .result-box.error { border-left: 3px solid #ef4444; }
    .result-box.streaming { border-left: 3px solid #3b82f6; }
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-indicator.online { background: #22c55e; }
    .status-indicator.offline { background: #ef4444; }
    .status-indicator.loading { background: #f59e0b; animation: pulse 1s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 13px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-size: 13px; color: #aaa; }
    .checkbox-group { display: flex; align-items: center; gap: 8px; }
    .checkbox-group input[type="checkbox"] { width: 16px; height: 16px; }
    select {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 14px;
    }
    .quick-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
    .stats-row {
      display: flex;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .stat-item {
      background: rgba(0,0,0,0.2);
      padding: 10px 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-item .value { font-size: 24px; font-weight: bold; color: #f59e0b; }
    .stat-item .label { font-size: 12px; color: #888; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”Œ API åä»£æœåŠ¡æµ‹è¯•</h1>

    <!-- é…ç½®é¢æ¿ -->
    <div class="config-panel">
      <div class="config-row">
        <div class="config-item">
          <label>æœåŠ¡åœ°å€</label>
          <input type="text" id="baseUrl" value="http://127.0.0.1:5580" style="width: 200px;">
        </div>
        <div class="config-item">
          <label>API Key (å¯é€‰)</label>
          <input type="password" id="apiKey" placeholder="ç•™ç©ºåˆ™ä¸éªŒè¯" style="width: 200px;">
        </div>
        <div class="config-item" style="align-self: flex-end;">
          <button class="btn btn-secondary" onclick="checkHealth()">
            <span class="status-indicator" id="healthStatus"></span>
            æ£€æŸ¥æœåŠ¡çŠ¶æ€
          </button>
        </div>
      </div>
    </div>

    <div class="test-grid">
      <!-- å¥åº·æ£€æŸ¥ -->
      <div class="test-card">
        <h3>â¤ï¸ å¥åº·æ£€æŸ¥ <span class="badge">GET /health</span></h3>
        <button class="btn btn-primary" onclick="testHealth()">å‘é€è¯·æ±‚</button>
        <div class="result-box" id="healthResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>

      <!-- æ¨¡å‹åˆ—è¡¨ -->
      <div class="test-card">
        <h3>ğŸ“‹ æ¨¡å‹åˆ—è¡¨ <span class="badge">GET /v1/models</span></h3>
        <button class="btn btn-primary" onclick="testModels()">è·å–æ¨¡å‹åˆ—è¡¨</button>
        <div class="result-box" id="modelsResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>

      <!-- OpenAI æ ¼å¼æµ‹è¯• -->
      <div class="test-card">
        <h3>ğŸ¤– OpenAI æ ¼å¼ <span class="badge">POST /v1/chat/completions</span></h3>
        <div class="form-group">
          <label>æç¤ºè¯</label>
          <textarea class="textarea" id="openaiPrompt">ä½ å¥½ï¼Œè¯·ç”¨ä¸€å¥è¯ä»‹ç»è‡ªå·±ã€‚</textarea>
        </div>
        <div class="form-group">
          <label>æ¨¡å‹</label>
          <select id="openaiModel">
            <option value="claude-opus-4-5">claude-opus-4.5 (æœ€å¼º)</option>
            <option value="claude-sonnet-4-5">claude-sonnet-4.5</option>
            <option value="claude-sonnet-4">claude-sonnet-4</option>
            <option value="claude-haiku-4-5">claude-haiku-4.5</option>
            <option value="claude-3-5-sonnet">claude-3.5-sonnet</option>
            <option value="gpt-4">gpt-4 (æ˜ å°„)</option>
          </select>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="openaiStream" checked>
          <label for="openaiStream">æµå¼è¾“å‡º (stream)</label>
        </div>
        <div style="margin-top: 15px;">
          <button class="btn btn-primary" onclick="testOpenAI()" id="openaiBtn">å‘é€è¯·æ±‚</button>
        </div>
        <div class="result-box" id="openaiResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>

      <!-- Claude æ ¼å¼æµ‹è¯• -->
      <div class="test-card">
        <h3>ğŸ­ Claude æ ¼å¼ <span class="badge">POST /v1/messages</span></h3>
        <div class="form-group">
          <label>æç¤ºè¯</label>
          <textarea class="textarea" id="claudePrompt">è¯·å†™ä¸€é¦–å…³äºç¼–ç¨‹çš„çŸ­è¯—ã€‚</textarea>
        </div>
        <div class="form-group">
          <label>æ¨¡å‹</label>
          <select id="claudeModel">
            <option value="claude-opus-4-5">claude-opus-4.5 (æœ€å¼º)</option>
            <option value="claude-sonnet-4-5">claude-sonnet-4.5</option>
            <option value="claude-sonnet-4">claude-sonnet-4</option>
            <option value="claude-haiku-4-5">claude-haiku-4.5</option>
            <option value="claude-3-5-sonnet">claude-3.5-sonnet</option>
          </select>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="claudeStream" checked>
          <label for="claudeStream">æµå¼è¾“å‡º (stream)</label>
        </div>
        <div style="margin-top: 15px;">
          <button class="btn btn-primary" onclick="testClaude()" id="claudeBtn">å‘é€è¯·æ±‚</button>
        </div>
        <div class="result-box" id="claudeResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>

      <!-- Agentic æ¨¡å¼æµ‹è¯• -->
      <div class="test-card">
        <h3>ğŸ¤– Agentic æ¨¡å¼ <span class="badge">å¸¦å·¥å…·è°ƒç”¨</span></h3>
        <div class="form-group">
          <label>æç¤ºè¯</label>
          <textarea class="textarea" id="agenticPrompt">ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ</textarea>
        </div>
        <div style="margin-top: 15px;">
          <button class="btn btn-primary" onclick="testAgentic()" id="agenticBtn">å‘é€è¯·æ±‚</button>
        </div>
        <div class="result-box" id="agenticResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>

      <!-- ç®¡ç† API -->
      <div class="test-card">
        <h3>âš™ï¸ ç®¡ç† API <span class="badge">éœ€è¦ API Key</span></h3>
        <div class="quick-actions">
          <button class="btn btn-secondary" onclick="testAdminStats()">è¯¦ç»†ç»Ÿè®¡</button>
          <button class="btn btn-secondary" onclick="testAdminAccounts()">è´¦å·åˆ—è¡¨</button>
          <button class="btn btn-secondary" onclick="testAdminLogs()">è¯·æ±‚æ—¥å¿—</button>
        </div>
        <div class="result-box" id="adminResult">ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚...</div>
      </div>
    </div>
  </div>

  <script>
    function getBaseUrl() {
      return document.getElementById('baseUrl').value.replace(/\/$/, '');
    }

    function getHeaders() {
      const apiKey = document.getElementById('apiKey').value;
      const headers = { 'Content-Type': 'application/json' };
      if (apiKey) {
        headers['Authorization'] = `Bearer ${apiKey}`;
      }
      return headers;
    }

    function formatResult(data, isError = false) {
      if (typeof data === 'object') {
        return JSON.stringify(data, null, 2);
      }
      return data;
    }

    function setResult(id, content, type = 'success') {
      const box = document.getElementById(id);
      box.textContent = content;
      box.className = `result-box ${type}`;
    }

    async function checkHealth() {
      const indicator = document.getElementById('healthStatus');
      indicator.className = 'status-indicator loading';
      try {
        const res = await fetch(`${getBaseUrl()}/health`);
        indicator.className = res.ok ? 'status-indicator online' : 'status-indicator offline';
      } catch (e) {
        indicator.className = 'status-indicator offline';
      }
    }

    async function testHealth() {
      try {
        const res = await fetch(`${getBaseUrl()}/health`);
        const data = await res.json();
        setResult('healthResult', formatResult(data), res.ok ? 'success' : 'error');
      } catch (e) {
        setResult('healthResult', `é”™è¯¯: ${e.message}`, 'error');
      }
    }

    async function testModels() {
      try {
        const res = await fetch(`${getBaseUrl()}/v1/models`, { headers: getHeaders() });
        const data = await res.json();
        setResult('modelsResult', formatResult(data), res.ok ? 'success' : 'error');
      } catch (e) {
        setResult('modelsResult', `é”™è¯¯: ${e.message}`, 'error');
      }
    }

    async function testOpenAI() {
      const btn = document.getElementById('openaiBtn');
      btn.disabled = true;
      const resultBox = document.getElementById('openaiResult');
      resultBox.textContent = '';
      resultBox.className = 'result-box streaming';

      const prompt = document.getElementById('openaiPrompt').value;
      const model = document.getElementById('openaiModel').value;
      const stream = document.getElementById('openaiStream').checked;

      try {
        const res = await fetch(`${getBaseUrl()}/v1/chat/completions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            model,
            messages: [{ role: 'user', content: prompt }],
            stream,
            max_tokens: 1024
          })
        });

        if (!res.ok) {
          const error = await res.text();
          setResult('openaiResult', `HTTP ${res.status}: ${error}`, 'error');
          return;
        }

        if (stream) {
          const reader = res.body.getReader();
          const decoder = new TextDecoder();
          let content = '';

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value);
            const lines = chunk.split('\n').filter(l => l.startsWith('data: '));

            for (const line of lines) {
              const data = line.slice(6);
              if (data === '[DONE]') continue;
              try {
                const json = JSON.parse(data);
                const delta = json.choices?.[0]?.delta?.content || '';
                content += delta;
                resultBox.textContent = content;
              } catch (e) {}
            }
          }
          resultBox.className = 'result-box success';
        } else {
          const data = await res.json();
          const content = data.choices?.[0]?.message?.content || JSON.stringify(data, null, 2);
          setResult('openaiResult', content, 'success');
        }
      } catch (e) {
        setResult('openaiResult', `é”™è¯¯: ${e.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    }

    async function testClaude() {
      const btn = document.getElementById('claudeBtn');
      btn.disabled = true;
      const resultBox = document.getElementById('claudeResult');
      resultBox.textContent = '';
      resultBox.className = 'result-box streaming';

      const prompt = document.getElementById('claudePrompt').value;
      const model = document.getElementById('claudeModel').value;
      const stream = document.getElementById('claudeStream').checked;

      try {
        const res = await fetch(`${getBaseUrl()}/v1/messages`, {
          method: 'POST',
          headers: {
            ...getHeaders(),
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model,
            messages: [{ role: 'user', content: prompt }],
            stream,
            max_tokens: 1024
          })
        });

        if (!res.ok) {
          const error = await res.text();
          setResult('claudeResult', `HTTP ${res.status}: ${error}`, 'error');
          return;
        }

        if (stream) {
          const reader = res.body.getReader();
          const decoder = new TextDecoder();
          let content = '';

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value);
            const lines = chunk.split('\n').filter(l => l.startsWith('data: '));

            for (const line of lines) {
              const data = line.slice(6);
              try {
                const json = JSON.parse(data);
                if (json.type === 'content_block_delta') {
                  content += json.delta?.text || '';
                  resultBox.textContent = content;
                }
              } catch (e) {}
            }
          }
          resultBox.className = 'result-box success';
        } else {
          const data = await res.json();
          const content = data.content?.[0]?.text || JSON.stringify(data, null, 2);
          setResult('claudeResult', content, 'success');
        }
      } catch (e) {
        setResult('claudeResult', `é”™è¯¯: ${e.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    }

    async function testAgentic() {
      const btn = document.getElementById('agenticBtn');
      btn.disabled = true;
      const resultBox = document.getElementById('agenticResult');
      resultBox.textContent = 'å‘é€å¸¦å·¥å…·çš„è¯·æ±‚...';
      resultBox.className = 'result-box streaming';

      const prompt = document.getElementById('agenticPrompt').value;

      try {
        const res = await fetch(`${getBaseUrl()}/v1/chat/completions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            model: 'claude-sonnet-4-5',
            messages: [{ role: 'user', content: prompt }],
            tools: [{
              type: 'function',
              function: {
                name: 'get_weather',
                description: 'è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯',
                parameters: {
                  type: 'object',
                  properties: {
                    city: { type: 'string', description: 'åŸå¸‚åç§°' }
                  },
                  required: ['city']
                }
              }
            }],
            stream: false,
            max_tokens: 1024
          })
        });

        if (!res.ok) {
          const error = await res.text();
          setResult('agenticResult', `HTTP ${res.status}: ${error}`, 'error');
          return;
        }

        const data = await res.json();
        setResult('agenticResult', formatResult(data), 'success');
      } catch (e) {
        setResult('agenticResult', `é”™è¯¯: ${e.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    }

    async function testAdminStats() {
      try {
        const res = await fetch(`${getBaseUrl()}/admin/stats`, { headers: getHeaders() });
        const data = await res.json();
        setResult('adminResult', formatResult(data), res.ok ? 'success' : 'error');
      } catch (e) {
        setResult('adminResult', `é”™è¯¯: ${e.message}`, 'error');
      }
    }

    async function testAdminAccounts() {
      try {
        const res = await fetch(`${getBaseUrl()}/admin/accounts`, { headers: getHeaders() });
        const data = await res.json();
        setResult('adminResult', formatResult(data), res.ok ? 'success' : 'error');
      } catch (e) {
        setResult('adminResult', `é”™è¯¯: ${e.message}`, 'error');
      }
    }

    async function testAdminLogs() {
      try {
        const res = await fetch(`${getBaseUrl()}/admin/logs`, { headers: getHeaders() });
        const data = await res.json();
        setResult('adminResult', formatResult(data), res.ok ? 'success' : 'error');
      } catch (e) {
        setResult('adminResult', `é”™è¯¯: ${e.message}`, 'error');
      }
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å¥åº·çŠ¶æ€
    checkHealth();
  </script>
</body>
</html>
